<div class="dashboard-layout">
  <!-- Debug indicator - remove after confirming it's working -->
  <div style="position: fixed; top: 10px; right: 10px; background: #5865f2; color: white; padding: 12px 20px; z-index: 99999; font-size: 14px; font-weight: 700; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); border: 2px solid white;">
    ‚úÖ NEW DASHBOARD v2.0 ACTIVE
  </div>
  
  <button 
    class="mobile-menu-toggle"
    (click)="toggleMobileMenu()"
    [attr.aria-label]="mobileMenuOpen ? 'Close menu' : 'Open menu'"
    type="button">
    {{ mobileMenuOpen ? '‚úï' : '‚ò∞' }}
  </button>

  <div class="mobile-overlay" 
       *ngIf="mobileMenuOpen"
       (click)="toggleMobileMenu()">
  </div>

  <app-server-sidebar
    [class.mobile-open]="mobileMenuOpen"
    [servers]="servers"
    [selectedServerId]="selectedServerId"
    [mobileOpen]="mobileMenuOpen"
    (serverSelected)="onServerSelected($event)">
  </app-server-sidebar>

  <app-channel-sidebar
    [class.mobile-open]="channelSidebarOpen || mobileMenuOpen"
    [channels]="channels"
    [selectedChannelId]="selectedChannelId"
    [serverName]="selectedServer?.name || 'Select a Revolt'"
    [currentUser]="currentUser"
    [mobileOpen]="channelSidebarOpen || mobileMenuOpen"
    (channelSelected)="onChannelSelected($event)">
  </app-channel-sidebar>

  <div class="main-content">
    <div class="content-wrapper">
      <div *ngIf="loading && selectedChannel" class="loading-indicator">
        Loading...
      </div>
      
      <!-- Show error as notification, not blocking main content -->
      <div *ngIf="error && !selectedChannel" class="error-notification">
        <div class="error-notification-content">
          <span class="error-icon">‚ö†Ô∏è</span>
          <span class="error-text">{{ error }}</span>
          <span class="error-hint">Please log in to access your servers</span>
        </div>
      </div>

      <!-- Empty state when no channel selected -->
      <div *ngIf="!selectedChannel && !loading" class="empty-state">
        <div class="empty-state-content">
          <div class="empty-state-icon">üí¨</div>
          <h3 class="empty-state-title">No Channel Selected</h3>
          <p class="empty-state-message" *ngIf="!error">Select a channel from the sidebar to start chatting</p>
          <p class="empty-state-message" *ngIf="error">Please log in to access your servers and channels</p>
        </div>
      </div>

      <!-- Show error in chat area if channel is selected but failed to load -->
      <div *ngIf="selectedChannel && error && selectedChannel.type === 0" class="error-message">
        {{ error }}
      </div>

      <!-- Text channel chat area -->
      <app-chat-area
        *ngIf="selectedChannel && selectedChannel.type === 0 && !loading && !error"
        [messages]="messages"
        [channelName]="selectedChannel.name || 'general'"
        [channelType]="0"
        [channelId]="selectedChannelId"
        (toggleChannelSidebar)="toggleChannelSidebar()"
        (toggleMemberList)="toggleMemberList()"
        (messageSent)="onMessageSent($event)">
      </app-chat-area>

      <!-- Voice channel -->
      <app-voice-chat
        *ngIf="selectedChannel && selectedChannel.type === 2 && !loading"
        [participants]="voiceParticipants"
        [channelName]="selectedChannel.name || 'Voice Channel'"
        [channelId]="selectedChannelId"
        [useService]="true">
      </app-voice-chat>
    </div>
  </div>

  <app-member-list
    [class.mobile-open]="memberListOpen"
    [members]="members"
    [mobileOpen]="memberListOpen">
  </app-member-list>
</div>
